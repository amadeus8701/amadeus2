<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Content</title>
</head>
<body>
    <h1>Text File Content</h1>
    <pre id="text-file-content">{{ textFileContent }}</pre> <!-- 수정된 부분 -->

    <h1>Image Display</h1>
    <img id="image-display" src="{{ latestImage }}" alt="Image"> <!-- 수정된 부분 -->

    <h2>Real-Time Log</h2>
    <ul id="log-list" style="overflow-y: scroll; max-height: 300px;">
        <!-- 이전 로그 항목들을 여기에 추가 -->
    </ul>

    <script>
        let oldTextFileContent = "{{ textFileContent }}"; // 초기 텍스트 파일 내용 저장
        let oldImageSrc = "{{ latestImage }}"; // 초기 이미지 파일 경로 저장
        let logCount = 0; // 로그 항목 개수 추적

        function addLogMessage(message) {
            const logList = document.getElementById('log-list');
            const logItem = document.createElement('li');
            logItem.textContent = message;
            logList.appendChild(logItem);
            logCount++;

            if (logCount > 15) {
                logList.removeChild(logList.firstChild);
                logCount--;
            }

            logList.scrollTop = logList.scrollHeight;
        }

        function pollContent() {
            // 텍스트 파일 내용 폴링
            fetch('/poll_text_file/', { method: 'GET' })
                .then(response => response.text())
                .then(newTextFileContent => {
                    if (newTextFileContent !== oldTextFileContent) {
                        const message = `Text File Updated: ${oldTextFileContent} => ${newTextFileContent}`;
                        addLogMessage(message);

                        document.getElementById('text-file-content').textContent = newTextFileContent;
                        oldTextFileContent = newTextFileContent;
                    }
                });

            // 이미지 파일 폴링
            fetch('/poll_image/', { method: 'GET' })
                .then(response => response.text())
                .then(newImageSrc => {
                    if (newImageSrc !== oldImageSrc) {
                        const message = `Image Updated: ${oldImageSrc} => ${newImageSrc}`;
                        addLogMessage(message);

                        document.getElementById('image-display').src = newImageSrc;
                        oldImageSrc = newImageSrc;
                    }
                });
        }

        setInterval(pollContent, 1000); // 1초마다 폴링
    </script>
</body>
</html>
