<!DOCTYPE html>
<html>
<head>
    <title>Text File Content</title>
</head>
<body>
    <h1>Text File Content</h1>
    <pre id="file-content">{{ content.content }}</pre>
    
    <!-- 새로운 입력을 받을 폼 -->
    <form id="input-form">
        <input type="text" id="new-input" placeholder="Enter a new input">
        <button type="submit">Submit</button>
    </form>
    
    <!-- 새로운 입력을 보여줄 로그 영역 -->
    <h2>Real-Time Log</h2>
    <ul id="log-list">
        <!-- 이전 로그 항목들을 여기에 추가 -->
    </ul>
    
    <script>
        let oldFileContent = "{{ content.content }}"; // 초기 파일 내용을 저장합니다.

        // 폼 제출을 감지하고 새로운 입력을 페이지에 추가하고 로그에 기록합니다.
        document.getElementById('input-form').addEventListener('submit', function (event) {
            event.preventDefault();
            const newInput = document.getElementById('new-input').value;
            if (newInput) {
                // 입력을 페이지에 추가합니다.
                const inputList = document.getElementById('input-list');
                const listItem = document.createElement('li');
                listItem.textContent = newInput;
                inputList.appendChild(listItem);
                
                // 로그에 기록합니다.
                const logList = document.getElementById('log-list');
                const logItem = document.createElement('li');
                logItem.textContent = `Content Updated: ${oldFileContent} => ${newInput}`;
                logList.appendChild(logItem);

                // 입력 필드를 지웁니다.
                document.getElementById('new-input').value = '';
            }
        });

        function pollFileContent() {
            // 파일 내용을 가져오기 위해 AJAX 요청을 보냅니다.
            fetch('/poll_file/', { method: 'GET' })
                .then(response => response.text())
                .then(newContent => {
                    // 새로운 내용이 이전 내용과 다르다면 페이지를 업데이트하고 로그에 기록합니다.
                    if (newContent !== oldFileContent) {
                        const logList = document.getElementById('log-list');
                        const logItem = document.createElement('li');
                        logItem.textContent = `Content Updated: ${oldFileContent} => ${newContent}`;
                        logList.appendChild(logItem);

                        document.getElementById('file-content').textContent = newContent;
                        oldFileContent = newContent; // 변경된 내용을 저장합니다.
                    }
                });
        }

        // 1초마다 파일 변경을 확인하기 위해 폴링 함수를 호출합니다.
        setInterval(pollFileContent, 1000);
    </script>
</body>
</html>